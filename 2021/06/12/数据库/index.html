<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_180.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/mylogo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/mylogo.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/manifest.json">
  <meta name="msapplication-config" content="/images/browserconfig.xml">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="baidu-site-verification" content="9MpsM2sptc">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"8.0.0-rc.5","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="数据库SQL概念主键 唯一标识表中每行的列才成为主键 若多列作为主键，列值的组合必须是唯一的  关键字顺序1SELECT &gt; DISTINCT &gt; AS &gt; FROM &gt; WHERE &gt; LIKE(REGEXP) &gt; ORDER BY &gt; BINARY &gt; DESC(ASC) &gt; LIMIT   查看操作 SHOWSHOW DATABASES：">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL">
<meta property="og:url" content="http://yoursite.com/2021/06/12/%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="Jettisons&#39; Blog">
<meta property="og:description" content="数据库SQL概念主键 唯一标识表中每行的列才成为主键 若多列作为主键，列值的组合必须是唯一的  关键字顺序1SELECT &gt; DISTINCT &gt; AS &gt; FROM &gt; WHERE &gt; LIKE(REGEXP) &gt; ORDER BY &gt; BINARY &gt; DESC(ASC) &gt; LIMIT   查看操作 SHOWSHOW DATABASES：">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420121310952.png">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420114802810.png">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420180237922.png">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420121053777.png">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420121125443.png">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420121822785.png">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420122153491.png">
<meta property="og:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210518122244917.png">
<meta property="article:published_time" content="2021-06-12T11:45:58.539Z">
<meta property="article:modified_time" content="2021-12-21T08:05:55.289Z">
<meta property="article:author" content="Jettison">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/Jet/AppData/Roaming/Typora/typora-user-images/image-20210420121310952.png">

<link rel="canonical" href="http://yoursite.com/2021/06/12/%E6%95%B0%E6%8D%AE%E5%BA%93/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>SQL | Jettisons' Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Jettisons' Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Hello,world</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">1</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">11</span></a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.</span> <span class="nav-text">数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">SQL概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE"><span class="nav-number">1.1.1.</span> <span class="nav-text">主键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.1.2.</span> <span class="nav-text">关键字顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%93%8D%E4%BD%9C-SHOW"><span class="nav-number">1.1.3.</span> <span class="nav-text">查看操作 SHOW</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E6%93%8D%E4%BD%9C-SELECT"><span class="nav-number">1.1.4.</span> <span class="nav-text">选择操作 SELECT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-number">1.1.5.</span> <span class="nav-text">通配符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.1.6.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5"><span class="nav-number">1.1.7.</span> <span class="nav-text">计算字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.8.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%B1%87%E6%80%BBGROUP-BY"><span class="nav-number">1.1.9.</span> <span class="nav-text">分组汇总GROUP BY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%94%E7%BB%93"><span class="nav-number">1.1.10.</span> <span class="nav-text">联结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.1.11.</span> <span class="nav-text">组合查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2"><span class="nav-number">1.1.12.</span> <span class="nav-text">全文本搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.13.</span> <span class="nav-text">插入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.14.</span> <span class="nav-text">更新和删除数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-number">1.1.15.</span> <span class="nav-text">表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="nav-number">1.1.15.1.</span> <span class="nav-text">创建表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A8"><span class="nav-number">1.1.15.2.</span> <span class="nav-text">更新表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="nav-number">1.1.15.3.</span> <span class="nav-text">删除表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="nav-number">1.1.15.4.</span> <span class="nav-text">重命名表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E6%93%8E"><span class="nav-number">1.1.16.</span> <span class="nav-text">引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-number">1.1.17.</span> <span class="nav-text">视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">1.1.18.</span> <span class="nav-text">存储过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87"><span class="nav-number">1.1.19.</span> <span class="nav-text">游标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">1.1.20.</span> <span class="nav-text">触发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="nav-number">1.1.21.</span> <span class="nav-text">事务处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86"><span class="nav-number">1.1.22.</span> <span class="nav-text">安全管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%B4%E6%8A%A4"><span class="nav-number">1.1.23.</span> <span class="nav-text">数据库维护</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%B9%E5%96%84%E6%80%A7%E8%83%BD"><span class="nav-number">1.1.24.</span> <span class="nav-text">改善性能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#csv%E6%96%87%E4%BB%B6%E7%9A%84%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="nav-number">1.2.</span> <span class="nav-text">csv文件的导入导出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%90%8C%E7%BB%93%E6%9E%84%E8%A1%A8"><span class="nav-number">1.3.</span> <span class="nav-text">创建相同结构表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#case-when"><span class="nav-number">1.4.</span> <span class="nav-text">case when</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="nav-number">1.5.</span> <span class="nav-text">常用指令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7mysql"><span class="nav-number">2.</span> <span class="nav-text">高级mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">2.1.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BC%98%E5%8A%A3"><span class="nav-number">2.1.1.</span> <span class="nav-text">索引的优劣</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E6%AD%A2%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="nav-number">2.1.2.</span> <span class="nav-text">防止索引失效</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dsql%E8%AF%AD%E5%8F%A5%E6%80%A7%E8%83%BD"><span class="nav-number">2.2.1.</span> <span class="nav-text">查看当前sql语句性能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="nav-number">2.2.2.</span> <span class="nav-text">优化建议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%A4%A7%E8%A1%A8"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">小表驱动大表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#order-by%E5%92%8Cgroup-by"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">order by和group by</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">2.3.</span> <span class="nav-text">慢查询日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E6%97%A5%E5%BF%97"><span class="nav-number">2.4.</span> <span class="nav-text">全局日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%AD%E5%8F%A5%E6%93%8D%E4%BD%9C%E9%A1%BA%E5%BA%8F"><span class="nav-number">2.5.</span> <span class="nav-text">语句操作顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E7%A7%8DJOIN"><span class="nav-number">2.6.</span> <span class="nav-text">七种JOIN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E9%94%81%E6%9C%BA%E5%88%B6"><span class="nav-number">2.7.</span> <span class="nav-text">MySQL锁机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98"><span class="nav-number">2.7.1.</span> <span class="nav-text">并发事务处理问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">2.7.2.</span> <span class="nav-text">数据库的事务隔离级别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E9%94%81"><span class="nav-number">2.7.3.</span> <span class="nav-text">行锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%B4%E9%9A%99%E9%94%81"><span class="nav-number">2.7.4.</span> <span class="nav-text">间隙锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%94%81%E5%AE%9A%E4%B8%80%E8%A1%8C"><span class="nav-number">2.7.5.</span> <span class="nav-text">如何锁定一行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E8%A1%8C%E9%94%81%E5%AE%9A"><span class="nav-number">2.7.6.</span> <span class="nav-text">分析行锁定</span></a></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jettison"
      src="/images/1.png">
  <p class="site-author-name" itemprop="name">Jettison</p>
  <div class="site-description" itemprop="description">Jettison</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0pldHRpc29ucw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Jettisons"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmpldHRpc29uc0AxNjMuY29t" title="E-Mail → mailto:jettisons@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>



      </section>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/06/12/%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/1.png">
      <meta itemprop="name" content="Jettison">
      <meta itemprop="description" content="Jettison">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jettisons' Blog">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-12 19:45:58" itemprop="dateCreated datePublished" datetime="2021-06-12T19:45:58+08:00">2021-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-21 16:05:55" itemprop="dateModified" datetime="2021-12-21T16:05:55+08:00">2021-12-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">tech</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><h2 id="SQL概念"><a href="#SQL概念" class="headerlink" title="SQL概念"></a>SQL概念</h2><h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><ul>
<li>唯一标识表中每行的列才成为主键</li>
<li>若多列作为主键，列值的组合必须是唯一的</li>
</ul>
<h3 id="关键字顺序"><a href="#关键字顺序" class="headerlink" title="关键字顺序"></a>关键字顺序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &gt; DISTINCT &gt; AS &gt; FROM &gt; WHERE &gt; LIKE(REGEXP) &gt; ORDER BY &gt; BINARY &gt; DESC(ASC) &gt; LIMIT</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210420121310952.png" alt="image-20210420121310952"></p>
<h3 id="查看操作-SHOW"><a href="#查看操作-SHOW" class="headerlink" title="查看操作 SHOW"></a>查看操作 SHOW</h3><p><code>SHOW DATABASES</code>：查看数据库</p>
<p><code>SHOW TABLES</code>：查看表 </p>
<p><code>SHOW COLUMNS FROM TABLE</code>或`DES：查看某张表的列</p>
<p><code>SHOW STATUS</code>：显示广泛的服务器状态信息</p>
<p><code>SHOW CREATE DATABASE</code>：创建特定数据库</p>
<p><code>SHOW CREATE TABLE</code>：创建表</p>
<p><code>SHOW GRANTS</code>：显示授予用户</p>
<p><code>SHOW ERRORS</code>&amp;<code>SHOW WARNINGS</code>：显示服务器错误或警告信息</p>
<h3 id="选择操作-SELECT"><a href="#选择操作-SELECT" class="headerlink" title="选择操作 SELECT"></a>选择操作 SELECT</h3><p><code>SELECT * FROM TABLE</code>：从表中选取所有列</p>
<p><code>SELECT DISTINCT id FROM TABLE</code>：从表中返回id列中不同的值<strong>（DISTINCT)</strong></p>
<p><code>SELECT prod_name FROM products LIMIT 5</code>：返回不多于5行</p>
<p><code>SELECT prod_name FROM products LIMIT 5,5</code>：返回从行5开始的5行(从行0计数，行5为第六行)</p>
<p><code>SELECT products.prod_name FROM crashcourse.products</code>：完全限定表示</p>
<blockquote>
<p>排序</p>
</blockquote>
<p><code>SELECT prod_id, prod_price, prod_name FROM products ORDER BY prod_price, prod_name</code>：检索三个列，先按prod_price排序，再按prod_name排序</p>
<p><code>SELECT prod_id, prod_price, prod_name FROM products ORDER BY prod_price DESC, prod_name ASC</code>：排序时按prod_price降序排序，按prod_name升序</p>
<p><code>SELECT prod_price FROM products ORDER BY prod_price DESC LIMIT 1</code>：找出最昂贵物品的价值</p>
<blockquote>
<p>过滤</p>
</blockquote>
<p><code>SELECT prod_name, prod_price FROM products WHERE prod_price = 2.5</code>：检索prod_price为2.5的行</p>
<p><code>SELECT prod_name, prod_price FROM products WHERE prod_price between 5 AND 10</code>：检索prod_price在5和10之间的行（between）</p>
<p><code>SELECT prod_name FROM products WHERE prod_price IS NULL</code>：空值检查</p>
<p><code>SELECT prod_id, prod_price, prod_name FROM products WHERE vend_id =1003 AND prod_price &lt;= 10</code>：AND语句检索条件</p>
<p><code>SELECT prod_id, prod_price, prod_name FROM products WHERE vend_id =1003 OR vend_id = 1003</code>：OR语句检索条件</p>
<p><code>SELECT prod_id, prod_price, prod_name FROM products WHERE (vend_id =1003 OR vend_id = 1003) AND prod_price &gt;= 10</code>：组合使用</p>
<p><code>SELECT prod_id, prod_price, prod_name FROM products WHERE vend_id IN (1002,1003)</code>：IN操作语句，和OR等价，但更快更简洁</p>
<p><code>SELECT prod_id, prod_price, prod_name FROM products WHERE vend_id NOT IN (1002,1003)</code>：NOT操作语句</p>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><p><code>SELECT prod_id, prod_name FROM products WHERE prod_name LIKE &#39;%anvil%&#39;</code>：LIKE语法，使用百分号%通配符可匹配任意字符</p>
<p><code>SELECT prod_id, prod_name FROM products WHERE prod_name LIKE &#39;_ ton anvil&#39;</code>：_下划线仅匹配一个字符</p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><p><code>SELECT prod_name FROM products WHERE prod_name REGEXP &#39;1000&#39; ORDER BY prod_name</code>：检索prod_name包含文本1000的所有行</p>
<p><code>REGEXP &#39;.000&#39;</code>：匹配任意一个字符</p>
<p><code>REGEXP BINARY &#39;Xxx&#39;</code>：BINARY关键字可区分大小写</p>
<p><code>SELECT prod_name FROM products WHERE prod_name REGEXP &#39;1000|2000&#39; ORDER BY prod_name</code>：‘|’可以表示‘或’关系</p>
<p><code>SELECT prod_name FROM products WHERE prod_name REGEXP &#39;[123] Ton&#39; ORDER BY prod_name</code>：[123]表示1或2或3，[^123]表示除了这些字符外的任何东西。[0-9]表示匹配0-9之间任意数字，[a-z]表示匹配a-z之间任意数字</p>
<p>匹配特殊字符必须加前置’\\‘，如<code>REGEXP &#39;\\.&#39;</code></p>
<blockquote>
<p>字符类</p>
</blockquote>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>[:alnum:]</td>
<td>任意字母和数字[a-zA-Z0-9]</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>任意字符[a-zA-Z]</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>空格和制表[\\t]</td>
</tr>
<tr>
<td>[:cntrl:]</td>
<td>ASCII控制字符(ASCII 0到31和127)</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>任意数字[0-9]</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>与[:print:]相同，但不包含空格</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>任意小写字母[a-z]</td>
</tr>
<tr>
<td>[:print:]</td>
<td>任意可打印字符</td>
</tr>
<tr>
<td>[:punct:]</td>
<td>既不在[:alnum:]又不在[:cntrl:]中的任意字符</td>
</tr>
<tr>
<td>[:space:]</td>
<td>包括空格在内的任意空白字符[\\f\\n\\r\\t\\v]</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>任意大写字母[A-Z]</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>任意十六进制数字[a-fA-F0-9]</td>
</tr>
</tbody></table>
<blockquote>
<p>重复元字符</p>
</blockquote>
<table>
<thead>
<tr>
<th>元字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>0或多个匹配</td>
</tr>
<tr>
<td>+</td>
<td>1个或多个匹配（等于{1,})</td>
</tr>
<tr>
<td>?</td>
<td>0个或1个匹配（等于{0,1})</td>
</tr>
<tr>
<td>{n}</td>
<td>指定数目的匹配</td>
</tr>
<tr>
<td>{n,}</td>
<td>不少于指定数目的匹配</td>
</tr>
<tr>
<td>{n,m}</td>
<td>匹配数目的范围</td>
</tr>
</tbody></table>
<p><code>SELECT prod_name FROM WHERE prod_name REGEXP &#39;[[:digit:]]&#123;4&#125;&#39; ORDER BY prod_name</code>：匹配任意连在一起的4位数字</p>
<blockquote>
<p>定位元字符</p>
</blockquote>
<table>
<thead>
<tr>
<th>元字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>文本的开始</td>
</tr>
<tr>
<td>$</td>
<td>文本的结尾</td>
</tr>
<tr>
<td>[[:&lt;:]]</td>
<td>词的开始</td>
</tr>
<tr>
<td>[[:&gt;:]]</td>
<td>词的结尾</td>
</tr>
</tbody></table>
<p><code>&#39;^[0-9\\.]&#39;</code>：以一个数或小数点开始的字符串</p>
<h3 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h3><blockquote>
<p>拼接Concat()</p>
</blockquote>
<p><code>SELECT Concat(vend_name, &#39;(&#39; , vend_country, &#39;)&#39;) FROM vendors ORDER BY vend_name</code>：Concat()拼接，各个串之间用逗号分隔</p>
<blockquote>
<p>去空格RTrim()、LTrim()、Trim()</p>
</blockquote>
<p><code>SELECT Concat(RTrim(vend_name), &#39;(&#39; , vend_country, &#39;)&#39;) FROM vendors ORDER BY vend_name</code>：RTrim用法</p>
<blockquote>
<p>别名（导出列）</p>
</blockquote>
<p><code>SELECT Concat(RTrim(vend_name), &#39;(&#39; , vend_country, &#39;)&#39;) AS vend_title FROM vendors ORDER BY vend_name</code>：创建一个包含指定计算的名为vend_title的计算字段</p>
<blockquote>
<p>执行算术计算</p>
</blockquote>
<p><code>SELECTF prod_id,quantity,item_price,quantity*item_price AS expanded_price FROM orderitems WHERE order_num = 20005</code>：输出四列，最后一列是数量和价格相乘</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><blockquote>
<p>文本处理函数</p>
</blockquote>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Left()</td>
<td>返回串左边的字符</td>
</tr>
<tr>
<td>Length()</td>
<td>返回串的长度</td>
</tr>
<tr>
<td>Locate()</td>
<td>找出串的一个字串</td>
</tr>
<tr>
<td>Lower()</td>
<td>将串转换为小写</td>
</tr>
<tr>
<td>LTrim()</td>
<td>去掉串左边的空格</td>
</tr>
<tr>
<td>Right()</td>
<td>返回串右边的字符</td>
</tr>
<tr>
<td>RTrim()</td>
<td>去掉串右边的空格</td>
</tr>
<tr>
<td>Soundex()</td>
<td>返回串的SOUNDEX值</td>
</tr>
<tr>
<td>SubString()</td>
<td>返回子串的字符</td>
</tr>
<tr>
<td>Upper()</td>
<td>将串转换为大写</td>
</tr>
</tbody></table>
<blockquote>
<p>日期和时间处理函数</p>
</blockquote>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AddDate()</td>
<td>增加一个日期（天、周等）</td>
</tr>
<tr>
<td>AddTime()</td>
<td>增加一个时间（时、分等）</td>
</tr>
<tr>
<td>CurDate()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CurTime()</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>Date()</td>
<td>返回日期时间的日期部分</td>
</tr>
<tr>
<td>DateDiff()</td>
<td>计算两个日期之差</td>
</tr>
<tr>
<td>Date_Add()</td>
<td>高度灵活的日期运算函数</td>
</tr>
<tr>
<td>Date_Format()</td>
<td>返回一个格式化的日期或时间串</td>
</tr>
<tr>
<td>Day()</td>
<td>返回一个日期的天数部分</td>
</tr>
<tr>
<td>DayOfWeek()</td>
<td>对于一个日期，返回对应的星期几</td>
</tr>
<tr>
<td>Hour()</td>
<td>返回一个时间的小时部分</td>
</tr>
<tr>
<td>Minute()</td>
<td>返回一个时间的分钟部分</td>
</tr>
<tr>
<td>Month()</td>
<td>返回一个日期的月份部分</td>
</tr>
<tr>
<td>Now()</td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td>Second()</td>
<td>返回一个时间的秒部分</td>
</tr>
<tr>
<td>Time()</td>
<td>返回一个日期时间的时间部分</td>
</tr>
<tr>
<td>Year()</td>
<td>返回一个日期的年份部分</td>
</tr>
</tbody></table>
<blockquote>
<p>数值处理函数</p>
</blockquote>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Abs()</td>
<td>返回一个数的绝对值</td>
</tr>
<tr>
<td>Cos()</td>
<td>返回一个角度的余弦</td>
</tr>
<tr>
<td>Exp()</td>
<td>返回一个数的指数值</td>
</tr>
<tr>
<td>Mod()</td>
<td>返回除操作的余数</td>
</tr>
<tr>
<td>Pi()</td>
<td>返回圆周率</td>
</tr>
<tr>
<td>Rand()</td>
<td>返回一个随机数</td>
</tr>
<tr>
<td>Sin()</td>
<td>返回一个角度的正弦</td>
</tr>
<tr>
<td>Sqrt()</td>
<td>返回一个数的平方根</td>
</tr>
<tr>
<td>Tan()</td>
<td>返回一个角度的正切</td>
</tr>
</tbody></table>
<blockquote>
<p>聚集函数</p>
</blockquote>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AVG()</td>
<td>返回某列的平均值</td>
</tr>
<tr>
<td>COUNT()</td>
<td>返回某列的行数</td>
</tr>
<tr>
<td>MAX()</td>
<td>返回某列的最大值</td>
</tr>
<tr>
<td>MIN()</td>
<td>返回某列的最小值</td>
</tr>
<tr>
<td>SUM()</td>
<td>返回某列量之和</td>
</tr>
</tbody></table>
<p><code>SELECT AVG(DISTINCT prod_price) AS ag_price FROM products WHERE vend_id = 1003</code>：<strong>DISTINCT</strong>后置不能跟*</p>
<blockquote>
<p>组合聚集函数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">COUNT(*) AS num_items,</span><br><span class="line">MIN(prod_price) AS price_min,</span><br><span class="line">MAX(prod_price) AS price_max,</span><br><span class="line">AVG(prod_price) AS price_avg </span><br><span class="line">FROM products;</span><br></pre></td></tr></table></figure>

<h3 id="分组汇总GROUP-BY"><a href="#分组汇总GROUP-BY" class="headerlink" title="分组汇总GROUP BY"></a>分组汇总GROUP BY</h3><p><code>select vend_id, count(*) as num_prods from products group by vend_id with rollup;</code>：<strong>WITH ROLLUP</strong> 可以统计汇总值</p>
<blockquote>
<p>过滤分组HAVING</p>
</blockquote>
<p><code>SELECT cust_id, count(*) AS orders FROM orders GROUP BY cust_id HAVING COUNT(\*) &gt;= 2</code>：<strong>WHERE</strong>在分组前过滤，<strong>HAVING</strong>在分组后过滤</p>
<blockquote>
<p>双重过滤</p>
</blockquote>
<p><code>SELECT vend_id, count(*) AS num_prods FROM products WHERE prod_price &gt;= 10 GROUP BY vend_id HAVING COUNT(\*) &gt;= 2</code>：列出具有2个（含）以上、价格为10（含）以上的产品的供应商</p>
<h3 id="联结"><a href="#联结" class="headerlink" title="联结"></a>联结</h3><blockquote>
<p>主键</p>
</blockquote>
<p>唯一标识</p>
<blockquote>
<p>外键</p>
</blockquote>
<p>其他表的主键</p>
<blockquote>
<p>等值联结（内部联结）</p>
</blockquote>
<p><code>SELECT vend_name, prod_name, prod_price FROM vendors, products WHERE vendors.vend_id = products.vend_id ORDER BY vend_name, prod_name</code>：通过WHERE创建联结，否则会返回笛卡尔积</p>
<p><code>SELECT vend_name, prod_name, prod_price FROM vendors INNER JOIN products ON vendors.vend_id = products.vend_id</code></p>
<blockquote>
<p>自联结</p>
</blockquote>
<p><code>SELECT p1.prod_id, p1.prod_name FROM products AS p1, products AS p2 WHERE p1.vend_id = p2.vend_id AND p2.prod_id = &#39;DTNTR&#39;</code>：自联结需要起表别名</p>
<blockquote>
<p>自然联结</p>
</blockquote>
<blockquote>
<p>外部联结</p>
</blockquote>
<p><code>SELECT customers.cust_id, orders.order_num FROM customers LEFT OUTER JOIN orders ON customers.cust_id = orders.cust_id</code>：(LEFT\RIGHT) OUTER JOIN 是外部联结，left表示选择左边表的所有行，right表示选择右边表的所有行。</p>
<blockquote>
<p>表别名</p>
</blockquote>
<p><code>FROM customers AS c, orders AS o, orderitems AS oi</code>：表别名只在查询执行中使用不返回到客户机</p>
<h3 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h3><blockquote>
<p>UNION</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT vend_id, prod_id, prod_price</span><br><span class="line">FROM products</span><br><span class="line">WHERE prod_price &lt;&#x3D; 5</span><br><span class="line">UNION</span><br><span class="line">SELECT vend_id, prod_id, prod_price</span><br><span class="line">FROM products</span><br><span class="line">WHERE vend_id IN (1001,1002);</span><br><span class="line">&#x2F;******************&#x2F;</span><br><span class="line">SELECT vend_id, prod_id, prod_price</span><br><span class="line">FROM products</span><br><span class="line">WHERE prod_price &lt;&#x3D; 5</span><br><span class="line">OR vend_id IN (1001,1002)</span><br></pre></td></tr></table></figure>

<p>规则：1、UNION必须由两条或两条以上SELECT语句组成；2、UNION中每个查询必须包含相同的列、表达式或聚集函数；3、列数据必须兼容</p>
<p>注意：对组合查询进行排序，ORDER BY子句必须出现在最后一条SELECT语句之后</p>
<blockquote>
<p>UNION ALL</p>
</blockquote>
<p>不过滤重复行</p>
<h3 id="全文本搜索"><a href="#全文本搜索" class="headerlink" title="全文本搜索"></a>全文本搜索</h3><p>支持引擎：MyISAM</p>
<p>不支持：InnoDB</p>
<p>在创建表时需要使用<code>FULLTEXT(column_name)</code>来建立索引</p>
<p><code>SELECT note_text FROM productnotes WHERE Match(note_text) Against(&#39;rabbit&#39;)</code>：Match中填写和FULLTEXT中的一致，Against中填写需要匹配的词，返回匹配的行</p>
<blockquote>
<p>查询扩展</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT note_text FROM productnotes WHERE Match(note_text) Against(&#39;anvils&#39; WITH QUERY EXPANSION);</span><br></pre></td></tr></table></figure>

<p>增加返回行数，匹配相近行</p>
<blockquote>
<p>布尔文本搜索</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT note_text</span><br><span class="line">FROM productnotes</span><br><span class="line">WHERE Match(note_text) Against(&#39;heavy -rope*&#39; IN BOOLEAN MODE);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>布尔操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>包含，词必须存在</td>
</tr>
<tr>
<td>-</td>
<td>排除，词必须不出现</td>
</tr>
<tr>
<td>&gt;</td>
<td>包含，且增加等级值</td>
</tr>
<tr>
<td>&lt;</td>
<td>包含，且减少等级值</td>
</tr>
<tr>
<td>()</td>
<td>把词组成子表达式</td>
</tr>
<tr>
<td>~</td>
<td>取消一个词的排序值</td>
</tr>
<tr>
<td>*</td>
<td>词尾的通配符</td>
</tr>
<tr>
<td>“”</td>
<td>定义一个短语</td>
</tr>
</tbody></table>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO customers(cust_name,cust_address,cust_city,cust_state,cust_country,cust_contact,cust_email)</span><br><span class="line">VALUES(&#39;Pep E. LaPew&#39;,&#39;100 Main Street&#39;,&#39;Los Angeles&#39;,&#39;CA&#39;,&#39;90046&#39;,&#39;USA&#39;,NULL,NULL);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>INSERT SELECT</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO customers(cust_id,cust_contact)</span><br><span class="line">SELECT cust_id,cust_contact FROM custnew;</span><br></pre></td></tr></table></figure>

<h3 id="更新和删除数据"><a href="#更新和删除数据" class="headerlink" title="更新和删除数据"></a>更新和删除数据</h3><blockquote>
<p>UPDATE</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE IGNORE customers</span><br><span class="line">SET cust_email &#x3D; &#39;elmer@fudd.com&#39;</span><br><span class="line">WHERE cust_id &#x3D; 10005;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>DELETE</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*删除行*&#x2F;</span><br><span class="line">DELETE FROM customers</span><br><span class="line">WHERE cust_id &#x3D; 10005;</span><br><span class="line">&#x2F;*删除表*&#x2F;</span><br><span class="line">TRUNCATE TABLE</span><br></pre></td></tr></table></figure>

<h3 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h3><h4 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE vendors IF NOT EXISTS</span><br><span class="line">(</span><br><span class="line">    vend_id    int      NOT NULL AUTO_INCREMENT,</span><br><span class="line">    order_date datetime NOT NULL,</span><br><span class="line">    cust_id    int      NOT NULL,</span><br><span class="line">    quantity   int      NOT NULL DEFAULT 1,</span><br><span class="line">    PRIMARY KEY (order_num)</span><br><span class="line">) ENGINE&#x3D;InnoDB</span><br><span class="line"></span><br><span class="line">&#x2F;*确定 AUTO_INCREMENT 值*&#x2F;</span><br><span class="line">SELECT last_insert_id()</span><br></pre></td></tr></table></figure>

<h4 id="更新表"><a href="#更新表" class="headerlink" title="更新表"></a>更新表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*给表添加一个列*&#x2F;</span><br><span class="line">ALTER TABLE vendors</span><br><span class="line">ADD vend_phone CHAR(20);</span><br><span class="line">&#x2F;*删除刚刚添加的列*&#x2F;</span><br><span class="line">ALTER TABLE vendors</span><br><span class="line">DROP COLUMN vend_phone;</span><br><span class="line">&#x2F;*定义外键*&#x2F;</span><br><span class="line">ALTER TABLE orderitems</span><br><span class="line">ADD CONSTRAINT fk_orderitems_orders</span><br><span class="line">FOREIGN KEY (order_num) REFERENCES orders (order_num);</span><br></pre></td></tr></table></figure>

<h4 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE customer32;</span><br></pre></td></tr></table></figure>

<h4 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME TABLE customers2 TO customers;</span><br></pre></td></tr></table></figure>

<h3 id="引擎"><a href="#引擎" class="headerlink" title="引擎"></a>引擎</h3><p><code>InnoDB</code>：可靠的事务处理引擎，不支持全文本搜索；开销大，加锁慢，会出现死锁；锁定粒度最小，发生锁冲突的概率也最低，并发度最高，支持行级锁</p>
<p><code>MEMORY</code>：功能等同于MyISAM，数据存储在内存中，速度很快，特别适合于临时表；开销小，加锁快；无死锁，锁定粒度大，发生锁冲突概率高，并发度最低</p>
<p><code>MyISAM</code>：性能极高，支持全文本搜索，不支持事务处理</p>
<p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210420114802810.png" alt="image-20210420114802810"></p>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*创建视图*&#x2F;</span><br><span class="line">CREATE VIEW XXX AS ...</span><br><span class="line">&#x2F;*查看视图*&#x2F;</span><br><span class="line">SHOW CREATE VIEW viewname</span><br><span class="line">&#x2F;*删除视图*&#x2F;</span><br><span class="line">DROP XXXX</span><br><span class="line">&#x2F;*更新视图*&#x2F;</span><br><span class="line">CREATE OR REPLACE VIEW</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*创建视图例子*&#x2F;</span><br><span class="line">CREATE VIEW productcustomers AS </span><br><span class="line">SELECT cust_name, cust_contact, prod_id</span><br><span class="line">FROM customers, orders, orderitems</span><br><span class="line">WHERE customers.cust_id &#x3D; orders.cust_id</span><br><span class="line">    AND orderitems.order_num &#x3D; orders.order_num;</span><br><span class="line">&#x2F;*使用视图例子*&#x2F;    </span><br><span class="line">SELECT cust_name, cust_contact</span><br><span class="line">FROM productcustomers</span><br><span class="line">WHERE prod_id &#x3D; &#39;TNT2&#39;;    </span><br></pre></td></tr></table></figure>

<blockquote>
<p>更新视图</p>
</blockquote>
<p>如果视图定义有以下操作，则不能进行视图的更新</p>
<ol>
<li>分组（使用GROUP BY 和HAVING）</li>
<li>联结</li>
<li>子查询</li>
<li>并</li>
<li>聚集函数（Min()、Count()、Sum()等）</li>
<li>DISTINCT</li>
<li>导出（计算列）</li>
</ol>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*创建存储过程*&#x2F;</span><br><span class="line">&#x2F;*当使用mysql命令行客户机时，‘；’分隔符在存储过程内会被解释，而无法成为存储过程的成分*&#x2F;</span><br><span class="line">DELIMITER &#x2F;&#x2F;</span><br><span class="line">CREATE PROCEDURE productpring(</span><br><span class="line">    OUT p1 DECIMAL(8,2)</span><br><span class="line">    OUT ph DECIMAL(8,2)</span><br><span class="line">    OUT pa DECIMAL(8,2))</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT Min(prod_price)</span><br><span class="line">    INTO p1</span><br><span class="line">    FROM products;</span><br><span class="line">    SELECT Max(prod_price)</span><br><span class="line">    INTO ph</span><br><span class="line">    FROM products;</span><br><span class="line">    SELECT Avg(prod_price)</span><br><span class="line">    INTO pa</span><br><span class="line">    FROM products;</span><br><span class="line">END &#x2F;&#x2F;</span><br><span class="line">&#x2F;*DELIMITER &#x2F;&#x2F;将&#x2F;&#x2F;作为新的语句结束分隔符，只有\符号无法作为语句分隔符*&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;*调用存储过程,需要传参*&#x2F;</span><br><span class="line">CALL productpricing(@pricelow,</span><br><span class="line">                       @pricehigh,</span><br><span class="line">                       @priceaverage);</span><br><span class="line"></span><br><span class="line">&#x2F;*删除存储过程*&#x2F;</span><br><span class="line">DROP PROCEDURE productpricing;</span><br><span class="line"></span><br><span class="line">&#x2F;*检查存储过程*&#x2F;</span><br><span class="line">SHOW CREATE PROCEDURE ordertotal;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>存储完整过程</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-- Name:ordertotal</span><br><span class="line">-- Parameters: onumber &#x3D; order number</span><br><span class="line">--             taxable &#x3D; 0 if not taxable, 1 if taxable</span><br><span class="line">--             ototal  &#x3D; order total variable</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE ordertotal(</span><br><span class="line">    IN onumber INT,</span><br><span class="line">    IN taxable BOOLEAN,</span><br><span class="line">    OUT ototal DECIMAL(8,2)</span><br><span class="line">) COMMENT &#39;Obtain order total, optionally adding tax&#39;</span><br><span class="line">BEGIN</span><br><span class="line">    -- Declare variable for total </span><br><span class="line">    DECLARE total DECIMAL(8,2);</span><br><span class="line">    -- Declare tax percentage</span><br><span class="line">    DECLARE taxrate INT DEFAULT 6;</span><br><span class="line"></span><br><span class="line">    --Get the order total</span><br><span class="line">    SELECT Sum(item_price*quantity)</span><br><span class="line">    FROM orderitems</span><br><span class="line">    WHERE order_num &#x3D; onumber</span><br><span class="line">    INTO total;</span><br><span class="line"></span><br><span class="line">    -- Is this taxable?</span><br><span class="line">    IF taxable THEN</span><br><span class="line">        -- Yes, so add taxrate to the total</span><br><span class="line">        SELECT total+(total&#x2F;100*taxrate) INTO total;</span><br><span class="line">    END IF;</span><br><span class="line"></span><br><span class="line">    -- And finally, save to out variable</span><br><span class="line">    SELECT total INTO ototal;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p><code>COMMENT</code>：表示注释</p>
<p><code>DECIMAL(8,2)</code>：8表示总共8位数，2表示后两位为小数</p>
<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">-- 开启游标</span><br><span class="line">OPEN cursorname;</span><br><span class="line">-- 关闭游标</span><br><span class="line">Close cursorname;</span><br><span class="line"></span><br><span class="line">&#x2F;*实例*&#x2F;</span><br><span class="line">CREATE PROCEDURE processorders()</span><br><span class="line">BEGIN</span><br><span class="line"></span><br><span class="line">    -- Declare local variables</span><br><span class="line">    DECLARE done BOOLEAN DEFAYLT 0;</span><br><span class="line">    DECLARE o INT;</span><br><span class="line">    DECLARE t DECIMAL(8,2);</span><br><span class="line"></span><br><span class="line">    -- Declare the cursor</span><br><span class="line">    DECLARE ordernumbers CURSOR</span><br><span class="line">    FOR </span><br><span class="line">    SELECT order_num FROM orders;</span><br><span class="line"></span><br><span class="line">    -- Declare continue handler </span><br><span class="line">    DECLARE CONTINUE HANDLER FOR SQLSTATE &#39;02000&#39; SET done&#x3D;1;</span><br><span class="line"></span><br><span class="line">    -- Create a table to store the results</span><br><span class="line">    CREATE TABLE IF NOT EXISTS ordertotals</span><br><span class="line">        (order_num INT, total DECIMAL(8,2));</span><br><span class="line"></span><br><span class="line">    -- Open the cursor</span><br><span class="line">    OPEN ordernumbers;</span><br><span class="line"></span><br><span class="line">    -- Loop through all rows</span><br><span class="line">    REPEAT</span><br><span class="line"></span><br><span class="line">        -- Get order number</span><br><span class="line">        DETCH ordernumbers INTO o;</span><br><span class="line"></span><br><span class="line">        -- Get the total for this order</span><br><span class="line">        CALL ordertotal(o,1,t);</span><br><span class="line"></span><br><span class="line">        -- Insert order and total into ordertotals</span><br><span class="line">        INSERT INTO ordertotals(order_num, total)</span><br><span class="line">        VALUES(o,t);</span><br><span class="line"></span><br><span class="line">    -- End of loop</span><br><span class="line">    UNTIL done END REPEAT;</span><br><span class="line"></span><br><span class="line">    --Close the cursor;</span><br><span class="line">    CLOSE ordernumbers;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p><code>SQLSTATE &#39;02000&#39;</code>：是一个未找到条件时的状态</p>
<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><p>触发器响应以下指令</p>
<ol>
<li>DELETE</li>
<li>INSERT</li>
<li>UPDATE</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-- 创建触发器,将信息存入asd变量中，使用SELECT @asd;查看</span><br><span class="line">CREATE TRIGGER newproduct AFTER INSERT ON products</span><br><span class="line">FOR EACH ROW SELECT &#39;Product added&#39; INTO @asd;</span><br><span class="line"></span><br><span class="line">-- INSERT触发器，返回新生成的订单号</span><br><span class="line">CREATE TRIGGER neworder AFTER INSERT ON orders</span><br><span class="line">FOR EACH ROW SELECT NEW.order_num;</span><br><span class="line"></span><br><span class="line">-- DELETE触发器,OLD是只读表，访问将被删除的行</span><br><span class="line">CREATE TRIGGER delteorder BEFORE DELETE ON orders</span><br><span class="line">FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">    INSERT INTO archive_orders(order_num, order_date, cust_id)</span><br><span class="line">    VALUES(OLD.roder_num, OLD.order_date, OLD.cust_id);</span><br><span class="line">END;</span><br><span class="line"></span><br><span class="line">-- UPDATE触发器，OLD虚拟表可访问更新前的值，NEW虚拟表访问更新后的值</span><br><span class="line">CREATE TRIGGER updatevendor BEFORE UPDATE ON venders</span><br><span class="line">FOR EACH ROW SET NEW.vend_state &#x3D; Upper(New.vend_state)</span><br><span class="line"></span><br><span class="line">-- 删除触发器</span><br><span class="line">DROP TRIGGER newproduct;</span><br><span class="line"></span><br><span class="line">--</span><br></pre></td></tr></table></figure>

<h3 id="事务处理"><a href="#事务处理" class="headerlink" title="事务处理"></a>事务处理</h3><p>事务（transactioin）：指一组SQL语句</p>
<p>回退（rollback）：指撤销指定SQL语句的过程</p>
<p>提交（commit）：指将未存储的SQL语句结果写入数据库表</p>
<p>保留点（savepoint）：指事务处理中设置的临时占位符，可以对其发布回退</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- ROLLBACK</span><br><span class="line">-- 开启事务处理，可通过ROLLBACK撤销其中的INSERT,UPDATE和DELETE语句</span><br><span class="line">START TRANSACTION;</span><br><span class="line">DELETE FROM ordertotals;</span><br><span class="line">ROLLBACK;</span><br><span class="line"></span><br><span class="line">-- COMMIT，在事务处理中必须主动提交，才会生效，若第二条delete失败，则前面的delete也自动撤销</span><br><span class="line">START TRANSACTION</span><br><span class="line">DELETE FROM orderitems WHERE order_num &#x3D; 20010;</span><br><span class="line">DELETE FROM orders WHERE order_num &#x3D; 20010;</span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line">-- SAVEPOINT，支持部分回退</span><br><span class="line">SAVEPOINT delete1;</span><br><span class="line">ROLLBACK TO delete1;</span><br></pre></td></tr></table></figure>

<h3 id="安全管理"><a href="#安全管理" class="headerlink" title="安全管理"></a>安全管理</h3><blockquote>
<p>用户管理</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 创建用户账号</span><br><span class="line">CREATE USER ben IDENTIFIED BY &#39;password&#39;;</span><br><span class="line"></span><br><span class="line">-- 重命名</span><br><span class="line">RENAME USER ben TO bfota</span><br><span class="line"></span><br><span class="line">-- 删除用户</span><br><span class="line">DROP USER bfota;</span><br><span class="line"></span><br><span class="line">-- 查看用户权限</span><br><span class="line">SHOW GRANTS FOR bfota;</span><br><span class="line"></span><br><span class="line">-- 设置用户权限, 允许用户在crashcourse数据库的所有表上使用SELECT</span><br><span class="line">GRANT SELECT ON crashcourse.* TO bfota;</span><br><span class="line"></span><br><span class="line">-- 撤销用户权限</span><br><span class="line">REVOKE SELECT ON crashcourse.* FROM bfota;</span><br><span class="line"></span><br><span class="line">-- 更改口令</span><br><span class="line">SET PASSWORD FOR bfota &#x3D; Password(&#39;n3dsifnfea&#39;);-- 为他人更改</span><br><span class="line">SET PASSWORD &#x3D; Password(&#39;lfasdfasd&#39;);-- 为自己更改</span><br></pre></td></tr></table></figure>

<h3 id="数据库维护"><a href="#数据库维护" class="headerlink" title="数据库维护"></a>数据库维护</h3><blockquote>
<p>备份数据</p>
</blockquote>
<p>备份前需要先<code>FLUSH TABLES</code>来刷新未写数据</p>
<ol>
<li><code>mysqldump</code>：转储所有数据库内容到某个外部文件</li>
<li><code>mysqlhotcopy</code>：从一个数据库复制所有数据</li>
<li>BACKUP TABLE<code>或</code>SELECT INTO OUTFILE<code>：转储所有数据到某个外部文件，给出文件名，且文件不能已存在，可以使用</code>RESTORE`恢复</li>
</ol>
<blockquote>
<p>维护</p>
</blockquote>
<ol>
<li><code>ANALYZE TABLE orders</code>：检查表键是否正确</li>
<li><code>CHECK TABLE orders</code>：检查表的各种问题</li>
</ol>
<blockquote>
<p>日志</p>
</blockquote>
<ul>
<li>错误日志，hostname.err</li>
<li>查询日志，hostname.log</li>
<li>二进制日志，hostname-bin</li>
<li>缓慢查询日志，hostname-slow.log</li>
</ul>
<p>刷新日志：<code>FLUSH LOGS</code></p>
<h3 id="改善性能"><a href="#改善性能" class="headerlink" title="改善性能"></a>改善性能</h3><p>查看当前设置：</p>
<p><code>SHOW VARIABLES</code></p>
<p><code>SHOW STATUS</code></p>
<p>显示所有活动线程：</p>
<p><code>SHOW PROCESSLIST</code></p>
<h2 id="csv文件的导入导出"><a href="#csv文件的导入导出" class="headerlink" title="csv文件的导入导出"></a>csv文件的导入导出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">--加载数据到建好的数据库表中</span><br><span class="line">LOAD data infile &#39;D:&#x2F;ProgramData&#x2F;MySQL&#x2F;MySQL Server 8.0_data&#x2F;Uploads&#x2F;jl_dl_.csv&#39; into table jl_dl_ fields terminated by &#39;,&#39; IGNORE 1 LINES;</span><br><span class="line">LOAD data infile &#39;D:&#x2F;ProgramData&#x2F;MySQL&#x2F;MySQL Server 8.0_data&#x2F;Uploads&#x2F;resource.csv&#39; into table resource fields terminated by &#39;,&#39; IGNORE 1 LINES;</span><br><span class="line">--输出查询结果到csv文件中,带表名</span><br><span class="line">SELECT</span><br><span class="line">    &#39;NMS_ORIG_RES_ID&#39;                 ,</span><br><span class="line">    &#39;CARD_ID&#39;                         ,</span><br><span class="line">    &#39;SUPER_RES_ID&#39;                    ,</span><br><span class="line">    &#39;SUPER_RES_POSITION_ID&#39;           ,</span><br><span class="line">    &#39;MANAGE_IPADDRESS&#39;              ,</span><br><span class="line">    &#39;EMS_ORIG_RES_NAME&#39;               ,</span><br><span class="line">    &#39;TECHNICAL_MODE&#39;                  ,</span><br><span class="line">    &#39;BROADBAND_SUB&#39;                   ,</span><br><span class="line">    &#39;IPTV_SUB&#39;                        ,</span><br><span class="line">    &#39;identityVOIP_SUB&#39;                ,</span><br><span class="line">    &#39;BROADBAND_FTTH_NUM&#39;              ,</span><br><span class="line">    &#39;BROADBAND_FTTB_LAN_NUM&#39;          ,</span><br><span class="line">    &#39;BROADBAND_FTTB_DSL_NUM&#39;          ,</span><br><span class="line">    &#39;BROADBAND_FTTH_PORTNUM&#39;          ,</span><br><span class="line">    &#39;BROADBAND_FTTB_LAN_PORTNUM&#39;      ,</span><br><span class="line">    &#39;BROADBAND_FTTB_DSL_PORTNUM&#39;      ,</span><br><span class="line">    &#39;BROADBAND_FTTH_ONTNUM&#39;           ,</span><br><span class="line">    &#39;BROADBAND_FTTB_LAN_USEDPORTNUM&#39;  ,</span><br><span class="line">    &#39;BROADBAND_FTTB_DSL_USEDPORTNUM&#39;  ,</span><br><span class="line">    &#39;BROADBAND_BELOW_10M_NUM&#39;         ,</span><br><span class="line">    &#39;BROADBAND_BELOW_20M_NUM&#39;         ,</span><br><span class="line">    &#39;BROADBAND_BELOW_50M_NUM&#39;         ,</span><br><span class="line">    &#39;BROADBAND_BELOW_100M_NUM&#39;        ,</span><br><span class="line">    &#39;BROADBAND_BELOW_200M_NUM&#39;        ,</span><br><span class="line">    &#39;BROADBAND_BELOW_300M_NUM&#39;        ,</span><br><span class="line">    &#39;BROADBAND_BELOW_500M_NUM&#39;        ,</span><br><span class="line">    &#39;BROADBAND_BELOW_1000M_NUM&#39;       ,</span><br><span class="line">    &#39;BROADBAND_ABOVE_1000M_NUM&#39;       ,</span><br><span class="line">    &#39;ADDR_FROM&#39;                       ,</span><br><span class="line">    &#39;STAND_NAME&#39;</span><br><span class="line">union select *</span><br><span class="line">from jl_dl_</span><br><span class="line">into outfile &#39;D:&#x2F;ProgramData&#x2F;MySQL&#x2F;MySQL Server 8.0_data&#x2F;Uploads&#x2F;1.csv&#39;</span><br><span class="line">CHARACTER SET gbk FIELDS TERMINATED BY &#39;,&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="创建相同结构表"><a href="#创建相同结构表" class="headerlink" title="创建相同结构表"></a>创建相同结构表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table A</span><br><span class="line">default charset &#x3D; utf8 comment &#39;xxx&#39;</span><br><span class="line">as select * from B where 1&#x3D;2;</span><br></pre></td></tr></table></figure>

<h2 id="case-when"><a href="#case-when" class="headerlink" title="case when"></a>case when</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veWF6ZGFvL2FyY2hpdmUvMjAwOS8xMi8wOS8xNjIwNDgyLmh0bWw=">https://www.cnblogs.com/yazdao/archive/2009/12/09/1620482.html<i class="fa fa-external-link-alt"></i></span></p>
<h2 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;查看存储引擎</span><br><span class="line">show variables like &#39;%storage_engine%&#39;;</span><br><span class="line">&#x2F;&#x2F;查看字符集</span><br><span class="line"> show variables like &#39;%char%&#39;;</span><br><span class="line"> show variables like &#39;names%&#39;;</span><br><span class="line"> &#x2F;&#x2F;查看安全路径</span><br><span class="line"> show variables like &#39;secure_file_priv&#39;;</span><br></pre></td></tr></table></figure>

<h1 id="高级mysql"><a href="#高级mysql" class="headerlink" title="高级mysql"></a>高级mysql</h1><ul>
<li>mysql内核</li>
<li>sql优化工程师</li>
<li>mysql服务器的优化</li>
<li>各种参数常量设定</li>
<li>查询语句优化</li>
<li>主从复制</li>
<li>软硬件升级</li>
<li>容灾备份</li>
<li>sql编程</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><blockquote>
<p>单值索引</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name &#x3D; &#39;&#39;;</span><br><span class="line">create index idx_user_name on user(name);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>复合索引</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name &#x3D; &#39;&#39; and email &#x3D; &#39;&#39;;</span><br><span class="line">create index idx_user_nameEmail on user(name,Email);</span><br></pre></td></tr></table></figure>

<h3 id="索引的优劣"><a href="#索引的优劣" class="headerlink" title="索引的优劣"></a>索引的优劣</h3><p>原理：B+树（多路搜索树），有聚集索引、次要索引、复合索引、前缀索引，唯一索引等，还有哈希索引</p>
<p>索引：排好序的快速查找数据结构</p>
<p>优势：</p>
<ul>
<li><p>类似大学图书馆建书目索引，提高数据检索的效率，降低数据库IO成本</p>
</li>
<li><p>通过索引列对数据进行排序，降低数据排序的成本，降低了CPU的消耗</p>
</li>
</ul>
<p>劣势：</p>
<ul>
<li>占用空间</li>
<li>降低更新表速度，（插入、更新、删除）</li>
</ul>
<p>索引分类：</p>
<ul>
<li>单值索引：一个索引只包含单个列，一个表可以有多个单列索引（建议5个）</li>
<li>唯一索引：索引列的值必须唯一，但允许有空值</li>
<li>符合索引：一个索引包含多个列</li>
</ul>
<p>基本语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;创建索引</span><br><span class="line">CREATE [UNIQUE] INDEX indexName ON mytable(columnname(length));</span><br><span class="line">ALTER mytable ADD [UNIQUE] INDEX [indexName] ON (columnname(length));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;添加主键，主键就是唯一索引</span><br><span class="line">ALTER TABLE table ADD PRIMARY KEY(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;全文索引</span><br><span class="line">ALTER TABLE table ADD FULLTEXT index_name(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;删除索引</span><br><span class="line">DROP INDEX [indexName] ON mytable;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;查看索引</span><br><span class="line">SHOW INDEX FR OM table_name;</span><br></pre></td></tr></table></figure>

<p>创建索引情况：</p>
<ul>
<li>主键自动建立唯一索引</li>
<li>频繁作为查询条件的字段应该创建索引</li>
<li>查询中与其他表关联的字段，外键关系建立索引</li>
<li>频繁更新的字段不适合创建索引</li>
<li>where条件里用不到的字段不创建索引</li>
<li>在高并发下倾向创建组合索引</li>
<li>查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度</li>
<li>查询中统计或分组字段</li>
</ul>
<p>不需创建索引：</p>
<ul>
<li>表记录太少</li>
<li>经常增删改的表</li>
<li>数据重复且分布平均的表字段</li>
</ul>
<h3 id="防止索引失效"><a href="#防止索引失效" class="headerlink" title="防止索引失效"></a>防止索引失效</h3><ul>
<li><p>左前缀法则：若索引多列，则遵循从左到右查询，不跳过</p>
</li>
<li><p>不在索引上做任何操作（计算、函数、类型转换）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;name为索引列</span><br><span class="line">select * from staffs where left(name,4) &#x3D; &#39;july&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>存储引擎不能使用索引中范围条件右边的索引列</p>
</li>
<li><p>尽量使用覆盖索引（只访问索引的查询（索引列和查询列一致））</p>
</li>
<li><p>mysql在使用不等于（!=或&lt;&gt;）的时候无法使用索引会导致全表扫描</p>
</li>
<li><p>is null, is not null 也无法使用索引而导致全表扫描</p>
</li>
<li><p>like以通配符开头(‘’%abc…’)会导致索引失效而导致全表扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 解决like&#39;%字符串%&#39;时索引不被使用的方法？</span><br><span class="line">使用覆盖索引</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串不加单引号索引失效（产生类型转换）</p>
</li>
<li><p>少用OR，用它连接时会导致索引失效</p>
</li>
</ul>
<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><blockquote>
<p>MySQL Query Optimizer</p>
</blockquote>
<blockquote>
<p>MySQL 常见瓶颈</p>
</blockquote>
<ul>
<li>CPU：饱和时</li>
<li>IO：磁盘装入数据远大于内存容量时</li>
<li>服务器硬件性能：<code>top</code>、<code>free</code>、<code>iostat</code>、<code>vmstat</code>来查看系统的性能状态</li>
</ul>
<h3 id="查看当前sql语句性能"><a href="#查看当前sql语句性能" class="headerlink" title="查看当前sql语句性能"></a>查看当前sql语句性能</h3><blockquote>
<p>EXPLAIN</p>
</blockquote>
<p>使用EXPLAIN关键字可以模拟优化器执行SQL查询语句，从而知道MYSQL是如何处理你的SQL语句的，分析查询语句或是表结构的性能瓶颈</p>
<p>可看到信息：</p>
<ul>
<li><p>表执行顺序</p>
</li>
<li><p>数据读取操作的操作类型（sekect_type）</p>
</li>
<li><p>哪些索引可以被使用</p>
</li>
<li><p>哪些索引被实际引用</p>
</li>
<li><p>表之间的引用</p>
</li>
<li><p>每张表有多少行被优化器查询</p>
</li>
</ul>
<p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210420180237922.png" alt="image-20210420180237922"></p>
<ul>
<li><p>id</p>
<ul>
<li>id相同，执行顺序由上至下</li>
<li>id不同，若子查询，id序号递增，id越大执行优先级越高</li>
<li>id相同和不同，同时存在</li>
</ul>
</li>
<li><p>select_type</p>
<ul>
<li><p>simple：简单的select查询，不包含子查询和union</p>
</li>
<li><p>primary：最外层查询</p>
</li>
<li><p>subquery：子查询</p>
</li>
<li><p>derived：子查询被标记为derived</p>
</li>
<li><p>union：若第二个select出现在union之后，则被标记为union，若union包含在from子句的子查询中，外层select将被标记为：derived</p>
</li>
<li><p>union result：union获取结果的select</p>
</li>
</ul>
</li>
<li><p>type</p>
<p>​    显示查询使用了何种类型，从最好到最差依次是</p>
<p>​    system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</p>
<ul>
<li>system ：表只有一行记录（等于系统表）</li>
<li>const：通过索引一次就找到了，只匹配一行数据</li>
<li>eq_ref：唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配，常见于主键或唯一索引扫描</li>
<li>ref：非唯一性索引扫描，返回匹配某个单独值的所有行</li>
<li>range：只检索给定范围的行，使用一个索引选择行。key列显示使用了哪个索引，一般就是在你的where语句红出现了between、&lt;、&gt;、in等的查询，比全表扫描好</li>
<li>index：只遍历索引树。 </li>
</ul>
</li>
<li><p>possible_keys：显示可能应用在这张表中的索引，一个或多个，不一定被查询实际使用</p>
</li>
<li><p>key：实际使用的索引，如果为NULL，则没有使用索引，查询中若使用了覆盖索引，则该索引仅出现在key列表中。</p>
</li>
<li><p>key_len：表示索引中使用的字节数，索引中使用的字节数，保证精确性情况下，长度越短越好，该值表示索引字段最大可能长度，并非实际使用长度。</p>
</li>
<li><p>ref：显示索引的哪一列被使用了</p>
</li>
<li><p>rows：根据表统计信息及索引选用情况，大致估算出找到所需的记录所需要读取的行数</p>
</li>
<li><p>extra：包含不适合在其他列中显示但十分重要的额外信息</p>
<ul>
<li>Using filesort：不按照表内索引顺序读取，自己又产生了一次排序，需要优化，危险</li>
<li>Using temporary：新建了临时表，常见于order by和group by，非常危险</li>
<li>Using index：表示响应select操作中使用了覆盖索引，避免访问了表的数据行，效率不错，如果同时出现了Using where，表明索引被用来执行索引键值的查找，如果没有出现，则表明索引用来读取数据而非执行查找动作。</li>
<li>Using where：使用了where查询</li>
<li>Using join buffer：使用了连接缓存</li>
<li>impossible where：where子句的值总是false，不能获取任何元组</li>
<li>select tables optimized away：在没有GROUPBY子句情况下，基于索引优化MIN/MAX操作或者对于MyISAM存储引擎优化COUNT(*)操作，不必等到执行阶段再进行计算，查询执行计划生成的阶段即完成优化</li>
<li>distinct：优化distinct操作，在找到第一匹配的元组后即停止找同样值的动作。</li>
</ul>
</li>
</ul>
<blockquote>
<p>show profile</p>
</blockquote>
<p>分析当前会话中sql语句执行的资源消耗情况的工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;执行一条sql语句后</span><br><span class="line">show profiles;</span><br><span class="line">&#x2F;&#x2F;出现</span><br><span class="line">show profile cpu,block io for query Query_ID;</span><br><span class="line">&#x2F;*Query_ID为#上步骤中show profiles列表中的Query_ID*&#x2F;</span><br></pre></td></tr></table></figure>

<ul>
<li>show profile的常用查询参数。</li>
</ul>
<p>①ALL：显示所有的开销信息。</p>
<p>②BLOCK IO：显示块IO开销。</p>
<p>③CONTEXT SWITCHES：上下文切换开销。</p>
<p>④CPU：显示CPU开销信息。</p>
<p>⑤IPC：显示发送和接收开销信息。</p>
<p>⑥MEMORY：显示内存开销信息。</p>
<p>⑦PAGE FAULTS：显示页面错误开销信息。</p>
<p>⑧SOURCE：显示和Source_function，Source_file，Source_line相关的开销信息。</p>
<p>⑨SWAPS：显示交换次数开销信息。</p>
<ul>
<li>日常开发需注意的结论。</li>
</ul>
<p>①converting HEAP to MyISAM：查询结果太大，内存不够，数据往磁盘上搬了。</p>
<p>②Creating tmp table：创建临时表。先拷贝数据到临时表，用完后再删除临时表。</p>
<p>③Copying to tmp table on disk：把内存中临时表复制到磁盘上，危险！！！</p>
<p>④locked。</p>
<p>如果在show profile诊断结果中出现了以上4条结果中的任何一条，则sql语句需要优化。</p>
<h3 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h3><h4 id="小表驱动大表"><a href="#小表驱动大表" class="headerlink" title="小表驱动大表"></a>小表驱动大表</h4><p>优化原则，使用小的数据集驱动大的数据集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;当B的数据集小于A的数据集时，用in优于exists</span><br><span class="line">select* from A where id in (select id from B)</span><br><span class="line">等价于:</span><br><span class="line">for select id from B</span><br><span class="line">for select * from A where A.id &#x3D; B.id</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;当A的数据集小于B的数据集时，用exists优于in</span><br><span class="line">select * from A where exists (select 1 from B wehre B.id &#x3D; A.id)</span><br><span class="line">等价于：</span><br><span class="line">for select * from A</span><br><span class="line">for select * from B where B.id &#x3D; A.id</span><br></pre></td></tr></table></figure>

<h4 id="order-by和group-by"><a href="#order-by和group-by" class="headerlink" title="order by和group by"></a>order by和group by</h4><ul>
<li><p>尽量用<code>using index</code>方式排序，避免用<code>using filesort</code>方式排序</p>
</li>
<li><p>遵循索引键的最佳左前缀</p>
</li>
<li><p>filesort有两种算法，单路排序和双路排序</p>
<ul>
<li>双路排序：从磁盘读取排序字段，在buffer进行排序，再从磁盘读取其他字段</li>
<li>单路排序：从磁盘读取所有字段，在buffer对排序字段排序，避免了第二次读取数据，但占用内存多。</li>
<li>存在问题：单路为后出的算法，性能更好。但是受限于sort_buffer容量，可能出现更多次I/O操作</li>
</ul>
</li>
<li><p>优化策略：</p>
<ul>
<li><p>order by时尽量不用 select *</p>
<p>当Query字段大小总和小于max_length_for_sort_data而且排序字段不是TEXT|BLOB类型时，会用单路排序，否则使用多路排序；</p>
<p>两种算法数据都有可能超出sort_buffer的容量，超出后会创建tmp文件进行合并排序，导致多次I/O，要提高sort_buffer_size</p>
</li>
<li><p>提高sort_buffer_size</p>
</li>
<li><p>提高max_length_for_sort_data，越大越有可能采用单路排序，但也更有可能超出sort_buffer_size，影响为高磁盘I/O活动和低处理器使用率</p>
</li>
</ul>
<p>where高于having，能用where不用having</p>
</li>
</ul>
<h2 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h2><p>默认不开启，开启有性能影响，仅在调参时使用</p>
<p>开启只对当前数据库生效，重启MySQL后会失效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;查看是否开启</span><br><span class="line">SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</span><br><span class="line">&#x2F;&#x2F;开启</span><br><span class="line">set global slow_query_log&#x3D;1;</span><br></pre></td></tr></table></figure>

<p>设置慢查询阈值（运行时间大于该阈值会被记录）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#39;long_query_time%&#39;; -- 单位为秒</span><br></pre></td></tr></table></figure>

<p>mysql日志分析（mysqldumpslow）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 得到返回记录集最多的10个SQL</span><br><span class="line">mysqldumpslow -s r -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;xxx.log | more</span><br><span class="line">-- 得到访问次数最多的10个SQL</span><br><span class="line">mysqldumpslow -s c -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;xxx.log | more</span><br><span class="line">-- 得到按照时间排序的前10条里面含有左连接的查询语句</span><br><span class="line"> mysqldumpslow -s t -t 10 -g &quot;left join&quot; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;xxx.log | more</span><br></pre></td></tr></table></figure>

<h2 id="全局日志"><a href="#全局日志" class="headerlink" title="全局日志"></a>全局日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set global general_log&#x3D;1;</span><br><span class="line">set global log_output&#x3D;&#39;TABLE&#39;;</span><br><span class="line">select * from mysql.general_</span><br></pre></td></tr></table></figure>

<h2 id="语句操作顺序"><a href="#语句操作顺序" class="headerlink" title="语句操作顺序"></a>语句操作顺序</h2><blockquote>
<p>手写</p>
</blockquote>
<p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210420121053777.png" alt="image-20210420121053777"></p>
<blockquote>
<p>机读</p>
</blockquote>
<p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210420121125443.png" alt="image-20210420121125443"></p>
<h2 id="七种JOIN"><a href="#七种JOIN" class="headerlink" title="七种JOIN"></a>七种JOIN</h2><p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210420121822785.png" alt="image-20210420121822785"></p>
<p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210420122153491.png" alt="image-20210420122153491"></p>
<h2 id="MySQL锁机制"><a href="#MySQL锁机制" class="headerlink" title="MySQL锁机制"></a>MySQL锁机制</h2><p>从对数据操作的类型分：</p>
<ul>
<li>读锁（共享锁），加读锁后，本进程只能读被锁表，且不可写，其它进程可读该表，但是写的话会阻塞。</li>
<li>写锁（排他锁），加写锁后，本进程只可读可写被锁表，其他表对该表不可操作</li>
</ul>
<p>读锁阻塞写但不阻塞读，而写锁会把读和写都阻塞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 手动增加表锁</span><br><span class="line">lock table 表名read(write),表名read(wirte)，其它;</span><br><span class="line">-- 查看表上加过的锁</span><br><span class="line">show open tables;</span><br><span class="line">-- 解锁表</span><br><span class="line">unlock tables;</span><br><span class="line">-- 分析表锁定</span><br><span class="line">show status like &#39;table%&#39;;</span><br></pre></td></tr></table></figure>

<p>Table_locks_immediate：产生表级锁定的次数，表示可以立即获取锁的查询次数</p>
<p>Table_locks_waited：出现表级锁定争用而发生等待的次数（不能立即获取锁的次数）</p>
<h3 id="并发事务处理问题"><a href="#并发事务处理问题" class="headerlink" title="并发事务处理问题"></a>并发事务处理问题</h3><ul>
<li>更新丢失（Lost Update）</li>
<li>脏读（Dirty Reads）</li>
<li>不可重复读（Non-Repeatable Reads）</li>
<li>幻读（Phantom Reads）</li>
</ul>
<h3 id="数据库的事务隔离级别"><a href="#数据库的事务隔离级别" class="headerlink" title="数据库的事务隔离级别"></a>数据库的事务隔离级别</h3><p><img src="C:\Users\Jet\AppData\Roaming\Typora\typora-user-images\image-20210518122244917.png" alt="image-20210518122244917"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 查看当前数据库的事务隔离级别</span><br><span class="line">show variables like &#39;tx_isolation&#39;;</span><br><span class="line">-- 设置数据库事务隔离级别</span><br><span class="line">set transaction isolation level read committed;</span><br></pre></td></tr></table></figure>

<h3 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h3><p>索引失效，行锁会变表锁</p>
<h3 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h3><blockquote>
<p>概念</p>
</blockquote>
<p>使用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；对于键值在条件范围内但并不存在的记录，叫做“间隙（GAP）”，</p>
<p>InnoDB也会对这个“间隙”加锁，这种锁机制就是所谓的间隙锁（Next-Key锁）</p>
<blockquote>
<p>危害</p>
</blockquote>
<p>因为Query执行过程中通过范围查找的话，会锁定整个范围内所有的索引键值，即使这个键值并不存在。</p>
<p>间隙锁有一个比较致命的弱点，就是当锁定一个范围键值后，即使某些不存在的键值也会被无辜的锁定，而造成在锁定的时候无法插入锁定键值范围内的任何数据。在某些场景下这可能会对性能造成很大的危害。</p>
<h3 id="如何锁定一行"><a href="#如何锁定一行" class="headerlink" title="如何锁定一行"></a>如何锁定一行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 锁定该行，用for update</span><br><span class="line">select * from table where a&#x3D;8 for update;</span><br></pre></td></tr></table></figure>

<h3 id="分析行锁定"><a href="#分析行锁定" class="headerlink" title="分析行锁定"></a>分析行锁定</h3><p>通过检查InnoDB_row_lock状态变量来分析系统上的行锁的争夺情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like &#39;innodb_row_lock%&#39;;</span><br></pre></td></tr></table></figure>

<ul>
<li>Innodb_row_lock_current_waits：当前正在等待锁定的数量</li>
<li>Innodb_row_lock_time：从系统启动到现在锁定总时间长度*</li>
<li>Innodb_row_lock_time_avg：每次等待所花平均时间*</li>
<li>Innodb_row_lock_time_max：从系统启动到现在等待最长的一次所花的时间</li>
<li>Innodb_row_lock_waits：系统启动后到现在总共等待的次数*</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/01/Java/" rel="prev" title="Java">
      <i class="fa fa-chevron-left"></i> Java
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/06/12/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/" rel="next" title="记录一次配置项目到ubuntu服务器上的操作">
      记录一次配置项目到ubuntu服务器上的操作 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jettison</span>
</div>
  <div class="powered-by">Powered by <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==">NexT.Gemini</span>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/next-boot.js"></script>


  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>















  

  

</body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
